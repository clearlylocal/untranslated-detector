{"version":3,"sources":["check.ts","App.tsx","index.tsx"],"names":["WORD_REGEX","STRIP_REGEX","EXCLUDE_REGEX","check","src","trg","comment","strippedSrc","replace","strippedTrg","iter","split","entries","Symbol","iterator","dupes","n","next","done","value","idx","seg","toLowerCase","includes","strs","nextSeg","join","push","last","pop","test","Set","filter","dupe","length","toLetter","num","x","String","fromCodePoint","codePointAt","toNumber","str","toUpperCase","Number","isNaN","stored","s","t","c","cmtmp","suf","JSON","parse","localStorage","getItem","suffixize","filename","suffix","match","pre","ext","Date","toISOString","flattenRichText","richText","map","text","parseExcelFile","files","commentTemplate","cols","a","Col","Src","Trg","Comments","file","reader","FileReader","onloadend","_event","arrayBuffer","result","ExcelJS","Workbook","xlsx","load","then","workbook","worksheets","forEach","sheet","eachRow","row","_rowNumber","omitted","values","getCell","Boolean","writeBuffer","buf","document","createElement","outFile","Blob","type","href","URL","createObjectURL","download","name","click","readAsArrayBuffer","App","useForm","register","watch","handleSubmit","filenameSuffix","useMemo","useEffect","onChange","data","setItem","stringify","defaultValue","ref","multiple","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.2a0ae91c.chunk.js","sourcesContent":["// used with `test` - can't use `g` flag or becomes stateful\nconst WORD_REGEX = /([\\p{Letter}\\p{Mark}]+)/u\n\nconst STRIP_REGEX = /%\\d\\$\\w|<[^>]+>/g\nconst EXCLUDE_REGEX = /[%${}[\\]#:<>]/\nconst MIN_LENGTH_ANY_CASE = 2\nconst MIN_LENGTH_LOWER_CASE = 3\n\nexport function check(src: string, trg: string, comment: string) {\n\tconst strippedSrc = src.replace(STRIP_REGEX, '\\x1e') // record separator\n\tconst strippedTrg = trg.replace(STRIP_REGEX, '\\x1f') // unit separator\n\t// record separator and unit separator are arbitrary, but must\n\t// a) never be present in translatable content,\n\t// b) not match WORD_REGEX,\n\t// c) be different from each other to avoid false matches\n\n\tconst srcSepsAndWords = strippedSrc.split(WORD_REGEX)\n\n\tconst iter = srcSepsAndWords.entries()[Symbol.iterator]()\n\n\tlet dupes: string[] = []\n\n\twhile (true) {\n\t\tlet n = iter.next()\n\n\t\tif (n.done) break\n\n\t\tconst [idx, seg] = n.value\n\n\t\tif (idx % 2 === 0) {\n\t\t\t// is separator\n\t\t\tcontinue\n\t\t}\n\n\t\tif (strippedTrg.toLowerCase().includes(seg.toLowerCase())) {\n\t\t\tlet strs = [seg]\n\n\t\t\twhile (true) {\n\t\t\t\tn = iter.next()\n\n\t\t\t\tif (n.done) break\n\n\t\t\t\t// prettier-ignore\n\t\t\t\tconst [/* idx */, nextSeg] = n.value;\n\n\t\t\t\tif (\n\t\t\t\t\tstrippedTrg\n\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t.includes((strs.join('') + nextSeg).toLowerCase())\n\t\t\t\t) {\n\t\t\t\t\tstrs.push(nextSeg)\n\t\t\t\t} else {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet last = ''\n\n\t\t\twhile (last === '') {\n\t\t\t\tlast = strs.pop()\n\t\t\t}\n\n\t\t\tif (WORD_REGEX.test(last)) {\n\t\t\t\tstrs.push(last)\n\t\t\t}\n\n\t\t\tdupes.push(strs.join(''))\n\t\t}\n\t}\n\n\treturn [...new Set(dupes)].filter((dupe) => {\n\t\tconst meetsMinLength =\n\t\t\tdupe.length >= MIN_LENGTH_LOWER_CASE ||\n\t\t\t(dupe !== dupe.toLowerCase() && dupe.length >= MIN_LENGTH_ANY_CASE)\n\n\t\treturn (\n\t\t\tmeetsMinLength &&\n\t\t\t!EXCLUDE_REGEX.test(dupe) &&\n\t\t\t!comment.includes(dupe)\n\t\t)\n\t})\n}\n","import { useEffect, useMemo } from 'react'\nimport { useForm } from 'react-hook-form'\nimport './App.css'\nimport { check } from './check'\nimport ExcelJS from 'exceljs'\n\nconst toLetter = (num: number) => {\n\tconst x = String.fromCodePoint(num + 'A'.codePointAt(0) - 1)\n\n\treturn !/[^A-Z]/.test(x) ? x : 'A'\n}\n\nconst toNumber = (str: string) => {\n\tconst x = /\\D/.test(str)\n\t\t? str.toUpperCase().codePointAt(0) - 'A'.codePointAt(0) + 1\n\t\t: Number(str)\n\n\treturn isNaN(x) ? 1 : x\n}\n\nconst init = {\n\ts: 9,\n\tt: 10,\n\tc: 11,\n\tcmtmp: 'Same as English: {{words}}',\n\tsuf: '_untranslated_{{date}}',\n}\n\nconst stored: typeof init = {\n\t...init,\n\t...JSON.parse(localStorage.getItem('form') ?? '{}'),\n}\n\nconst suffixize = (filename: string, suffix: string) => {\n\tconst [, pre, ext] = filename.match(/^(.+)(\\.[^.]+)$/) ?? [\n\t\tnull,\n\t\tfilename,\n\t\t'',\n\t]\n\n\treturn (\n\t\tpre +\n\t\tsuffix.replace(\n\t\t\t'{{date}}',\n\t\t\tnew Date().toISOString().replace(/\\D/g, ''),\n\t\t) +\n\t\text\n\t)\n}\n\nconst flattenRichText = (x: any) => {\n\tif (typeof x === 'string') {\n\t\treturn x\n\t}\n\n\tif (x.richText) {\n\t\treturn x.richText.map(({ text }) => text).join('')\n\t}\n\n\treturn String(x)\n}\n\nconst parseExcelFile = async (\n\tfiles: FileList,\n\tcommentTemplate: string,\n\tsuffix: string,\n\tcols: [number, number, number],\n) => {\n\tif (!files.length) return\n\n\tconst Col = {\n\t\tSrc: cols[0],\n\t\tTrg: cols[1],\n\t\tComments: cols[2],\n\t}\n\n\tfor (const file of files) {\n\t\tconst reader = new FileReader()\n\n\t\treader.onloadend = (_event) => {\n\t\t\tconst arrayBuffer = reader.result as ArrayBuffer\n\n\t\t\tconst workbook = new ExcelJS.Workbook()\n\n\t\t\tworkbook.xlsx.load(arrayBuffer).then(async (workbook) => {\n\t\t\t\tworkbook.worksheets.forEach((sheet) => {\n\t\t\t\t\tsheet.eachRow((row, _rowNumber) => {\n\t\t\t\t\t\tconst omitted = check(\n\t\t\t\t\t\t\tflattenRichText(row.values[Col.Src] ?? ''),\n\t\t\t\t\t\t\tflattenRichText(row.values[Col.Trg] ?? ''),\n\t\t\t\t\t\t\tflattenRichText(row.values[Col.Comments] ?? ''),\n\t\t\t\t\t\t)\n\n\t\t\t\t\t\tif (omitted.length) {\n\t\t\t\t\t\t\trow.getCell(Col.Comments).value = [\n\t\t\t\t\t\t\t\trow.values[Col.Comments],\n\t\t\t\t\t\t\t\tcommentTemplate.replace(\n\t\t\t\t\t\t\t\t\t'{{words}}',\n\t\t\t\t\t\t\t\t\tomitted.map((x) => `“${x}”`).join(', '),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t\t\t.join('\\n---\\n')\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t})\n\n\t\t\t\tconst buf = await workbook.xlsx.writeBuffer({})\n\n\t\t\t\tconst a = document.createElement('a')\n\t\t\t\tconst outFile = new Blob([buf], {\n\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t})\n\t\t\t\ta.href = URL.createObjectURL(outFile)\n\t\t\t\ta.download = suffixize(file.name, suffix)\n\t\t\t\ta.click()\n\t\t\t})\n\t\t}\n\n\t\treader.readAsArrayBuffer(file)\n\t}\n}\n\nexport const App = () => {\n\tconst { register, watch, handleSubmit } = useForm()\n\n\tconst changeHandler = (data: any) => {\n\t\tdata = { ...data }\n\n\t\tdata.s = toNumber(data.s)\n\t\tdata.t = toNumber(data.t)\n\t\tdata.c = toNumber(data.c)\n\n\t\tlocalStorage.setItem('form', JSON.stringify(data))\n\t}\n\n\tconst commentTemplate: string = watch('cmtmp') ?? stored.cmtmp\n\tconst filenameSuffix: string = watch('suf') ?? stored.suf\n\n\tconst s: number = Number(toNumber(watch('s') ?? stored.s))\n\tconst t: number = Number(toNumber(watch('t') ?? stored.t))\n\tconst c: number = Number(toNumber(watch('c') ?? stored.c))\n\n\tconst files: FileList = useMemo(\n\t\t() => watch('file') ?? ([] as any as FileList),\n\t\t[watch],\n\t)\n\n\tuseEffect(() => {\n\t\tparseExcelFile(files, commentTemplate, filenameSuffix, [s, t, c])\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [files /* commentTemplate, filenameSuffix */])\n\n\treturn (\n\t\t<form onChange={handleSubmit(changeHandler)}>\n\t\t\t<label>\n\t\t\t\tComments template\n\t\t\t\t<input\n\t\t\t\t\tname='cmtmp'\n\t\t\t\t\tdefaultValue={stored.cmtmp}\n\t\t\t\t\tref={register}\n\t\t\t\t/>\n\t\t\t</label>\n\t\t\t<br />\n\t\t\t<br />\n\t\t\t<label>\n\t\t\t\tOutput filename suffix\n\t\t\t\t<input name='suf' defaultValue={stored.suf} ref={register} />\n\t\t\t</label>\n\t\t\t<br />\n\t\t\t<br />\n\t\t\t<fieldset>\n\t\t\t\t<legend>Columns</legend>\n\n\t\t\t\t<label>\n\t\t\t\t\tSource column (eng)\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\tname='s'\n\t\t\t\t\t\tdefaultValue={toLetter(\n\t\t\t\t\t\t\ttypeof stored.s === 'number'\n\t\t\t\t\t\t\t\t? stored.s\n\t\t\t\t\t\t\t\t: toNumber(stored.s)\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tref={register}\n\t\t\t\t\t/>\n\t\t\t\t</label>\n\t\t\t\t<br />\n\t\t\t\t<label>\n\t\t\t\t\tTarget column (e.g. th-rTH)\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\tname='t'\n\t\t\t\t\t\tdefaultValue={toLetter(\n\t\t\t\t\t\t\ttypeof stored.t === 'number'\n\t\t\t\t\t\t\t\t? stored.t\n\t\t\t\t\t\t\t\t: toNumber(stored.t)\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tref={register}\n\t\t\t\t\t/>\n\t\t\t\t</label>\n\t\t\t\t<br />\n\t\t\t\t<label>\n\t\t\t\t\tComments column (for output)\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\tname='c'\n\t\t\t\t\t\tdefaultValue={toLetter(\n\t\t\t\t\t\t\ttypeof stored.c === 'number'\n\t\t\t\t\t\t\t\t? stored.c\n\t\t\t\t\t\t\t\t: toNumber(stored.c)\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tref={register}\n\t\t\t\t\t/>\n\t\t\t\t</label>\n\t\t\t</fieldset>\n\n\t\t\t<br />\n\t\t\t<br />\n\t\t\t<label>\n\t\t\t\tUpload file (XLSX)\n\t\t\t\t<input type='file' name='file' multiple ref={register} />\n\t\t\t</label>\n\t\t</form>\n\t)\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport { App } from './App'\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById('root'),\n)\n"],"sourceRoot":""}